
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PostgreSQL schema and functions for Spatio-Temporal Asset Catalog (STAC).">
      
      
      
        <link rel="canonical" href="https://stac-utils.github.io/pgstac/pypgstac/">
      
      
        <link rel="prev" href="../pgstac/">
      
      
        <link rel="next" href="../item_size_analysis/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>pyPgSTAC - pgstac</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#migrations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="pgstac" class="md-header__button md-logo" aria-label="pgstac" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pgstac
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              pyPgSTAC
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stac-utils/pgstac" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    stac-utils/pgstac
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="pgstac" class="md-nav__button md-logo" aria-label="pgstac" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pgstac
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stac-utils/pgstac" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    stac-utils/pgstac
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pgstac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PgSTAC
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    pyPgSTAC
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    pyPgSTAC
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Migrations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Running Migrations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bootstrapping-an-empty-database" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrapping an Empty Database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bootstrapping an Empty Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-execute-as-power-user" class="md-nav__link">
    <span class="md-ellipsis">
      Option 1: Execute as Power User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-create-user-with-initial-grants" class="md-nav__link">
    <span class="md-ellipsis">
      Option 2: Create User with Initial Grants
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Verifying Migration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bulk-data-loading" class="md-nav__link">
    <span class="md-ellipsis">
      Bulk Data Loading
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-queryables" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Queryables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automated-collection-extent-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Collection Extent Updates
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../item_size_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    impacts of STAC item footprint size on dynamic tiling query performance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development - Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Migrations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Running Migrations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bootstrapping-an-empty-database" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrapping an Empty Database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bootstrapping an Empty Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-execute-as-power-user" class="md-nav__link">
    <span class="md-ellipsis">
      Option 1: Execute as Power User
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-create-user-with-initial-grants" class="md-nav__link">
    <span class="md-ellipsis">
      Option 2: Create User with Initial Grants
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verifying-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Verifying Migration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bulk-data-loading" class="md-nav__link">
    <span class="md-ellipsis">
      Bulk Data Loading
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-queryables" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Queryables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automated-collection-extent-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Automated Collection Extent Updates
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>pyPgSTAC</h1>

<p>PgSTAC includes a Python utility for bulk data loading and managing migrations.</p>
<p>pyPgSTAC is available on PyPI
<div class="highlight"><pre><span></span><code>python -m pip install pypgstac
</code></pre></div></p>
<p>By default, pyPgSTAC does not install the <code>psycopg</code> dependency. If you want the database driver installed, use:</p>
<div class="highlight"><pre><span></span><code>python -m pip install pypgstac[psycopg]
</code></pre></div>
<p>Or can be built locally
<div class="highlight"><pre><span></span><code>git clone https://github.com/stac-utils/pgstac
cd pgstac/pypgstac
python -m pip install .
</code></pre></div></p>
<div class="highlight"><pre><span></span><code>pypgstac --help
Usage: pypgstac [OPTIONS] COMMAND [ARGS]...

Options:
  --install-completion  Install completion for the current shell.
  --show-completion     Show completion for the current shell, to copy it or
                        customize the installation.

  --help                Show this message and exit.

Commands:
  initversion  Get initial version.
  load         Load STAC data into a pgstac database.
  migrate      Migrate a pgstac database.
  pgready      Wait for a pgstac database to accept connections.
  version      Get version from a pgstac database.
</code></pre></div>
<p>pyPgSTAC will get the database connection settings from the <strong>standard PG environment variables</strong>:</p>
<ul>
<li>PGHOST=0.0.0.0</li>
<li>PGPORT=5432</li>
<li>PGUSER=username</li>
<li>PGDATABASE=postgis</li>
<li>PGPASSWORD=asupersecretpassword</li>
</ul>
<p>It can also take a DSN database url "postgresql://..." via the <strong>--dsn</strong> flag.</p>
<h3 id="migrations">Migrations<a class="headerlink" href="#migrations" title="Permanent link">&para;</a></h3>
<p>pyPgSTAC has a utility to help apply migrations to an existing PgSTAC instance to bring it up to date.</p>
<p>There are two types of migrations:</p>
<ul>
<li><strong>Base migrations</strong> install PgSTAC into a database with no current PgSTAC installation. These migrations follow the file pattern <code>"pgstac.[version].sql"</code></li>
<li><strong>Incremental migrations</strong> are used to move PgSTAC from one version to the next. These migrations follow the file pattern <code>"pgstac.[version].[fromversion].sql"</code></li>
</ul>
<p>Migrations are stored in <code>pypgstac/pypgstac/migrations</code> and are distributed with the pyPgSTAC package.</p>
<h3 id="running-migrations">Running Migrations<a class="headerlink" href="#running-migrations" title="Permanent link">&para;</a></h3>
<p>pyPgSTAC has a utility for checking the version of an existing PgSTAC database and applying the appropriate migrations in the correct order. It can also be used to setup a database from scratch.</p>
<p>To create an initial PgSTAC database or bring an existing one up to date, check you have the pypgstac version installed you want to migrate to and run:
<div class="highlight"><pre><span></span><code>pypgstac migrate
</code></pre></div></p>
<h3 id="bootstrapping-an-empty-database">Bootstrapping an Empty Database<a class="headerlink" href="#bootstrapping-an-empty-database" title="Permanent link">&para;</a></h3>
<p>When starting with an empty database, you have two options for initializing PgSTAC:</p>
<h4 id="option-1-execute-as-power-user">Option 1: Execute as Power User<a class="headerlink" href="#option-1-execute-as-power-user" title="Permanent link">&para;</a></h4>
<p>This approach uses a database user with administrative privileges (such as 'postgres') to run the migration, which will automatically create all necessary extensions and roles:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Set environment variables for database connection</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGHOST</span><span class="o">=</span>localhost
<span class="nb">export</span><span class="w"> </span><span class="nv">PGPORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGDATABASE</span><span class="o">=</span>yourdatabase
<span class="nb">export</span><span class="w"> </span><span class="nv">PGUSER</span><span class="o">=</span>postgres<span class="w">  </span><span class="c1"># A user with admin privileges</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGPASSWORD</span><span class="o">=</span>yourpassword

<span class="c1"># Run the migration</span>
pypgstac<span class="w"> </span>migrate
</code></pre></div>
<p>The migration process will automatically:
- Create required extensions (postgis, btree_gist, unaccent)
- Create necessary roles (pgstac_admin, pgstac_read, pgstac_ingest)
- Set up the pgstac schema and tables</p>
<p>In production environments, you should assign these roles to your application database user rather than continuing to use the postgres user:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Grant appropriate roles to your application user</span>
<span class="k">GRANT</span><span class="w"> </span><span class="n">pgstac_read</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">your_app_user</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="n">pgstac_ingest</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">your_app_user</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="n">pgstac_admin</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">your_app_user</span><span class="p">;</span>

<span class="c1">-- Set the search path for your application user</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">your_app_user</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">pgstac</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">;</span>
</code></pre></div>
<h4 id="option-2-create-user-with-initial-grants">Option 2: Create User with Initial Grants<a class="headerlink" href="#option-2-create-user-with-initial-grants" title="Permanent link">&para;</a></h4>
<p>If you don't have administrative privileges or prefer more control over the setup process, you can manually prepare the database before running migrations.</p>
<p>Connect to your database as an administrator and execute:</p>
<div class="highlight"><pre><span></span><code><span class="err">\</span><span class="k">c</span><span class="w"> </span><span class="p">[</span><span class="k">database</span><span class="p">]</span>

<span class="c1">-- Create required extensions</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">postgis</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">btree_gist</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">unaccent</span><span class="p">;</span>

<span class="c1">-- Create required roles</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">pgstac_admin</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">pgstac_read</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">pgstac_ingest</span><span class="p">;</span>

<span class="c1">-- Grant appropriate permissions</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="p">[</span><span class="k">database</span><span class="p">]</span><span class="w"> </span><span class="k">OWNER</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">];</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">]</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">pgstac</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="p">[</span><span class="k">database</span><span class="p">]</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">pgstac</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">CONNECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="p">[</span><span class="k">database</span><span class="p">]</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">];</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">TABLES</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">];</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SEQUENCES</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">];</span>
<span class="k">GRANT</span><span class="w"> </span><span class="n">pgstac_read</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">]</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">ADMIN</span><span class="w"> </span><span class="k">OPTION</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="n">pgstac_ingest</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">]</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">ADMIN</span><span class="w"> </span><span class="k">OPTION</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="n">pgstac_admin</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="p">]</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">ADMIN</span><span class="w"> </span><span class="k">OPTION</span><span class="p">;</span>
</code></pre></div>
<p>Then run the migration as your non-admin user:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Set environment variables for database connection</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGHOST</span><span class="o">=</span>localhost
<span class="nb">export</span><span class="w"> </span><span class="nv">PGPORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGDATABASE</span><span class="o">=</span>yourdatabase
<span class="nb">export</span><span class="w"> </span><span class="nv">PGUSER</span><span class="o">=[</span>user<span class="o">]</span><span class="w">  </span><span class="c1"># Your non-admin user</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGPASSWORD</span><span class="o">=</span>yourpassword

<span class="c1"># Run the migration</span>
pypgstac<span class="w"> </span>migrate
</code></pre></div>
<h3 id="verifying-migration">Verifying Migration<a class="headerlink" href="#verifying-migration" title="Permanent link">&para;</a></h3>
<p>To verify that PgSTAC was installed correctly:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check the PgSTAC version</span>
pypgstac<span class="w"> </span>version
</code></pre></div>
<h3 id="bulk-data-loading">Bulk Data Loading<a class="headerlink" href="#bulk-data-loading" title="Permanent link">&para;</a></h3>
<p>A python utility is included which allows to load data from any source openable by smart-open using python in a memory efficient streaming manner using PostgreSQL copy. There are options for collections and items and can be used either as a command line or a library.</p>
<p>To load an ndjson of items directly using copy (will fail on any duplicate ids but is the fastest option to load new data you know will not conflict)
<div class="highlight"><pre><span></span><code>pypgstac load items
</code></pre></div></p>
<p>To load skipping any records that conflict with existing data
<div class="highlight"><pre><span></span><code>pypgstac load items --method insert_ignore
</code></pre></div></p>
<p>To upsert any records, adding anything new and replacing anything with the same id
<div class="highlight"><pre><span></span><code>pypgstac load items --method upsert
</code></pre></div></p>
<h3 id="loading-queryables">Loading Queryables<a class="headerlink" href="#loading-queryables" title="Permanent link">&para;</a></h3>
<p>Queryables are a mechanism that allows clients to discover what terms are available for use when writing filter expressions in a STAC API. The Filter Extension enables clients to filter collections and items based on their properties using the Common Query Language (CQL2).</p>
<p>To load queryables from a JSON file:</p>
<div class="highlight"><pre><span></span><code>pypgstac load_queryables queryables.json
</code></pre></div>
<p>To load queryables for specific collections:</p>
<div class="highlight"><pre><span></span><code>pypgstac load_queryables queryables.json --collection_ids [collection1,collection2]
</code></pre></div>
<p>To load queryables and delete properties not present in the file:</p>
<div class="highlight"><pre><span></span><code>pypgstac load_queryables queryables.json --delete_missing
</code></pre></div>
<p>To load queryables and create indexes only for specific fields:</p>
<div class="highlight"><pre><span></span><code>pypgstac load_queryables queryables.json --index_fields [field1,field2]
</code></pre></div>
<p>By default, no indexes are created when loading queryables. Using the <code>--index_fields</code> parameter allows you to selectively create indexes only for fields that require them. Creating too many indexes can degrade database performance, especially for write operations, so it's recommended to only index fields that are frequently used in queries.</p>
<p>When using <code>--delete_missing</code> with specific collections, only properties for those collections will be deleted:</p>
<div class="highlight"><pre><span></span><code>pypgstac load_queryables queryables.json --collection_ids [collection1,collection2] --delete_missing
</code></pre></div>
<p>You can combine all parameters as needed:</p>
<div class="highlight"><pre><span></span><code>pypgstac load_queryables queryables.json --collection_ids [collection1,collection2] --delete_missing --index_fields [field1,field2]
</code></pre></div>
<p>The JSON file should follow the queryables schema as described in the <a href="https://github.com/stac-api-extensions/filter#queryables">STAC API - Filter Extension</a>. Here's an example:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://json-schema.org/draft/2019-09/schema&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;$id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://example.com/stac/queryables&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Queryables for Example STAC API&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Queryable names for the Example STAC API&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Item identifier&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;datetime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Datetime&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;date-time&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;eo:cloud_cover&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cloud cover percentage&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;minimum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;maximum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;additionalProperties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>
<p>The command will extract the properties from the JSON file and create queryables in the database. It will also determine the appropriate property wrapper based on the type of each property and create the necessary indexes.</p>
<h3 id="automated-collection-extent-updates">Automated Collection Extent Updates<a class="headerlink" href="#automated-collection-extent-updates" title="Permanent link">&para;</a></h3>
<p>By setting <code>pgstac.update_collection_extent</code> to <code>true</code>, a trigger is enabled to automatically adjust the spatial and temporal extents in collections when new items are ingested. This feature, while helpful, may increase overhead within data load transactions. To alleviate performance impact, combining this setting with <code>pgstac.use_queue</code> is beneficial. This approach necessitates a separate process, such as a scheduled task via the <code>pg_cron</code> extension, to periodically invoke <code>CALL run_queued_queries();</code>. Such asynchronous processing ensures efficient transactional performance and updated collection extents.</p>
<p><em>Note: The <code>pg_cron</code> extension must be properly installed and configured to manage the scheduling of the <code>run_queued_queries()</code> function.</em></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/stac-utils" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/STACspec" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>